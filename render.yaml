services:
    # Serviço 1: O Banco de Dados PostgreSQL
    - type: psql
      name: bot-database
      plan: free

    # Serviço 2: A Instância do Redis
    - type: redis
      name: bot-redis
      plan: free

    # Serviço 3: O Serviço Web (Django/Gunicorn)
    - type: web
      name: bot-web
      runtime: python
      plan: free
      buildCommand: "./build.sh"
      startCommand: "gunicorn config.wsgi"
      envVars:
          - key: DATABASE_URL
            fromDatabase:
                name: bot-database
                property: connectionString
          - key: REDIS_URL
            fromRedis:
                name: bot-redis
                property: connectionString
          - key: PYTHON_VERSION
            value: 3.12.6
          - key: SECRET_KEY
            generateValue: true # O Render vai gerar uma chave segura automaticamente

    # Serviço 4: O Worker em Segundo Plano (Celery)
    - type: worker
      name: bot-worker
      runtime: python
      plan: free
      buildCommand: "pip install -r requirements.txt"
      startCommand: "celery -A config worker -l info -P gevent"
      envVars:
          - key: DATABASE_URL
            fromDatabase:
                name: bot-database
                property: connectionString
          - key: REDIS_URL
            fromRedis:
                name: bot-redis
                property: connectionString
          - key: PYTHON_VERSION
            value: 3.12.6
          - key: SECRET_KEY
            # Pega a mesma chave secreta gerada para o serviço web
            fromService:
                type: web
                name: bot-web
                envVarKey: SECRET_KEY
